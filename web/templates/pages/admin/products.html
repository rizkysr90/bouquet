{{ define "admin-content-products" }}
<div class="space-y-6">
    <!-- Page Header -->
    <div class="flex items-center justify-between">
        <h1 class="text-2xl font-bold text-gray-900">Manage Products</h1>
        <a href="/admin/products/new" class="bg-pink-600 hover:bg-pink-700 text-white font-medium py-2 px-4 rounded-lg transition">
            + Add New Product
        </a>
    </div>

    <!-- Search Bar -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
        <form method="GET" action="/admin/products" class="flex gap-4">
            <input type="text" 
                   name="search" 
                   value="{{ .SearchQuery }}"
                   placeholder="Search by code or title..."
                   class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500">
            <button type="submit" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-6 rounded-lg transition">
                Search
            </button>
            {{ if .SearchQuery }}
            <a href="/admin/products" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-lg transition">
                Clear
            </a>
            {{ end }}
        </form>
    </div>

    <!-- Products Table -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Photo</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Code</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {{ if .Products }}
                    {{ range .Products }}
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <img src="{{ if .MainPhotoURL }}{{ .MainPhotoURL }}{{ else }}data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='50' height='50'%3E%3Crect fill='%23e5e7eb' width='50' height='50'/%3E%3C/svg%3E{{ end }}" 
                                 alt="{{ .Title }}" 
                                 class="w-12 h-12 object-cover rounded">
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">{{ .Code }}</div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="text-sm text-gray-900">{{ .Title }}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-500">
                                {{ if .Category }}{{ .Category.Name }}{{ else }}‚Äî{{ end }}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">Rp {{ printf "%.0f" .BasePrice }}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex gap-2">
                                {{ if .IsSold }}
                                <span class="px-2 py-1 text-xs font-semibold bg-gray-100 text-gray-800 rounded">Sold Out</span>
                                {{ else }}
                                    {{ if and .Variants (gt (len .Variants) 0) }}
                                        {{ $hasSale := false }}
                                        {{ range .Variants }}
                                            {{ if .IsSale }}
                                                {{ $hasSale = true }}
                                            {{ end }}
                                        {{ end }}
                                        {{ if $hasSale }}
                                        <span class="px-2 py-1 text-xs font-semibold bg-red-100 text-red-800 rounded">Sale</span>
                                        {{ end }}
                                    {{ end }}
                                {{ end }}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <div class="flex items-center justify-end gap-3">
                                <a href="/admin/products/{{ .ID }}/edit" 
                                   class="text-blue-600 hover:text-blue-900" 
                                   title="Edit">
                                    ‚úèÔ∏è
                                </a>
                                <button onclick="confirmDelete({{ .ID }})" 
                                        class="text-red-600 hover:text-red-900" 
                                        title="Delete">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </td>
                    </tr>
                    {{ end }}
                    {{ else }}
                    <tr>
                        <td colspan="7" class="px-6 py-12 text-center text-gray-500">
                            <p class="mb-2">No products found.</p>
                            <a href="/admin/products/new" class="text-pink-600 hover:text-pink-700 font-medium">Create your first product</a>
                        </td>
                    </tr>
                    {{ end }}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        {{ if and .Pagination (gt .Pagination.TotalPages 1) }}
        <div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
            <div class="flex items-center justify-between">
                <div class="text-sm text-gray-700">
                    Showing page {{ .Pagination.CurrentPage }} of {{ .Pagination.TotalPages }} 
                    ({{ .Pagination.Total }} total products)
                </div>
                <div class="flex gap-2">
                    {{ $currentPage := .Pagination.CurrentPage }}
                    {{ $totalPages := .Pagination.TotalPages }}
                    {{ $prevPage := sub $currentPage 1 }}
                    {{ $nextPage := add $currentPage 1 }}
                    
                    {{ if gt $currentPage 1 }}
                    <a href="?page={{ $prevPage }}{{ if .SearchQuery }}&search={{ .SearchQuery }}{{ end }}" 
                       class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                        Previous
                    </a>
                    {{ end }}

                    {{ range $i := (seq 1 $totalPages) }}
                    {{ if or (eq $i 1) (eq $i $totalPages) (and (ge $i (sub $currentPage 2)) (le $i (add $currentPage 2))) }}
                    <a href="?page={{ $i }}{{ if $.SearchQuery }}&search={{ $.SearchQuery }}{{ end }}" 
                       class="px-4 py-2 border rounded-lg transition {{ if eq $i $currentPage }}bg-pink-600 text-white border-pink-600{{ else }}border-gray-300 hover:bg-gray-50{{ end }}">
                        {{ $i }}
                    </a>
                    {{ else if or (eq $i (sub $currentPage 3)) (eq $i (add $currentPage 3)) }}
                    <span class="px-2 text-gray-400">...</span>
                    {{ end }}
                    {{ end }}

                    {{ if lt $currentPage $totalPages }}
                    <a href="?page={{ $nextPage }}{{ if .SearchQuery }}&search={{ .SearchQuery }}{{ end }}" 
                       class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                        Next
                    </a>
                    {{ end }}
                </div>
            </div>
        </div>
        {{ end }}
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Confirm Delete</h3>
        <p class="text-gray-600 mb-6">Are you sure you want to delete this product? This action cannot be undone.</p>
        <div class="flex gap-3 justify-end">
            <button onclick="closeDeleteModal()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                Cancel
            </button>
            <button type="button" onclick="submitDelete()" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition">
                Delete
            </button>
        </div>
    </div>
</div>

<script>
    let deleteProductId = null;

    function confirmDelete(productId) {
        deleteProductId = productId;
        document.getElementById('deleteModal').classList.remove('hidden');
    }

    function submitDelete() {
        if (!deleteProductId) return;
        
        // Create form to submit DELETE via POST with CSRF token
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/admin/products/' + deleteProductId + '/delete';
        
        // Add CSRF token
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = '_csrf';
        csrfInput.value = '{{ .CSRFToken }}';
        form.appendChild(csrfInput);
        
        document.body.appendChild(form);
        form.submit();
        
        closeDeleteModal();
    }

    function closeDeleteModal() {
        document.getElementById('deleteModal').classList.add('hidden');
        deleteProductId = null;
    }

    // Close modal on outside click
    document.getElementById('deleteModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeDeleteModal();
        }
    });
</script>
{{ end }}

